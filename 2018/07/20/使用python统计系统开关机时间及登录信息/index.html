<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/avatar-6.png?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, Jony">










<meta name="description" content="日常开发中使用python可以做一些小工具，相对C语言和shell脚本来说使用起来很简单，而且是解释执行的，所以开发和使用效率比较高。 需求审计一下linux（或者说是类unix系统）下系统的开关机、登录、注销情况。 分析linux下系统的开关机、登录和注销行为都有日志记录，该日志文件位于/var/log/wtmp, 我们只需要监测日志文件的变化，通过对比变化前后的内容就可以知道我们要监测变更信息">
<meta property="og:type" content="article">
<meta property="og:title" content="使用python统计系统开关机时间及登录信息">
<meta property="og:url" content="http://yoursite.com/2018/07/20/使用python统计系统开关机时间及登录信息/index.html">
<meta property="og:site_name" content="My Love">
<meta property="og:description" content="日常开发中使用python可以做一些小工具，相对C语言和shell脚本来说使用起来很简单，而且是解释执行的，所以开发和使用效率比较高。 需求审计一下linux（或者说是类unix系统）下系统的开关机、登录、注销情况。 分析linux下系统的开关机、登录和注销行为都有日志记录，该日志文件位于/var/log/wtmp, 我们只需要监测日志文件的变化，通过对比变化前后的内容就可以知道我们要监测变更信息">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-04-27T03:00:32.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用python统计系统开关机时间及登录信息">
<meta name="twitter:description" content="日常开发中使用python可以做一些小工具，相对C语言和shell脚本来说使用起来很简单，而且是解释执行的，所以开发和使用效率比较高。 需求审计一下linux（或者说是类unix系统）下系统的开关机、登录、注销情况。 分析linux下系统的开关机、登录和注销行为都有日志记录，该日志文件位于/var/log/wtmp, 我们只需要监测日志文件的变化，通过对比变化前后的内容就可以知道我们要监测变更信息">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/07/20/使用python统计系统开关机时间及登录信息/">





  <title>使用python统计系统开关机时间及登录信息 | My Love</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
<a href="https://github.com/jiaoqiyuan" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">My Love</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">I will be stronger</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-主页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            主页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-关于我">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于我
          </a>
        </li>
      
        
        <li class="menu-item menu-item-标签">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-分类">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-归档">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/20/使用python统计系统开关机时间及登录信息/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jony Chiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar-6.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Love">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">使用python统计系统开关机时间及登录信息</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-20T05:30:15+08:00">
                2018-07-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/20/使用python统计系统开关机时间及登录信息/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count gitment-comments-count" data-xid="/2018/07/20/使用python统计系统开关机时间及登录信息/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 浏览
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  14
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <pre><code>日常开发中使用python可以做一些小工具，相对C语言和shell脚本来说使用起来很简单，而且是解释执行的，所以开发和使用效率比较高。
</code></pre><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>审计一下linux（或者说是类unix系统）下系统的开关机、登录、注销情况。</p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>linux下系统的开关机、登录和注销行为都有日志记录，该日志文件位于/var/log/wtmp, 我们只需要监测日志文件的变化，通过对比变化前后的内容就可以知道我们要监测变更信息。</p>
<p>另外这个日志文件是二进制形式的，不能直接打开查看，可以使用last命令查看，另外通过添加以下last命令的参数可以更好地获取里面的信息。</p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p>这里是通过c文件调用python脚本获取python脚本执行的输出信息来进行行为审计的，重点将以下python部分，也就是处理日志信息的那里。</p>
<p>整个工作流程是这样的，c文件负责定时调用python脚本，python脚本负责获取当前last命令下输出的内容信息，然后对比本地缓存的之前的last信息，通过差异项来判断那些是登录操作，哪些是注销操作，是本地行为还是远程链接等等。</p>
<p>通过下面的命令可以获取到最近的30条系统登录信息：<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">last</span> -F -x -n <span class="number">30</span></span><br></pre></td></tr></table></figure></p>
<p>比如本机的</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">第一列    第二列        第三列            第四列                      第五列                      第六列</span><br><span class="line">wst      pts/1        192.168.8.167    Fri Jul<span class="number"> 20 </span>16:01:10<span class="number"> 2018 </span>  still logged in</span><br><span class="line">wst      pts/1        192.168.8.167    Fri Jul<span class="number"> 20 </span>15:55:41<span class="number"> 2018 </span>- Fri Jul<span class="number"> 20 </span>15:56:01<span class="number"> 2018 </span> (00:00)</span><br><span class="line">wst      pts/0        192.168.8.167    Fri Jul<span class="number"> 20 </span>15:39:27<span class="number"> 2018 </span>  still logged in</span><br><span class="line">wst      pts/0        192.168.8.167    Fri Jul<span class="number"> 20 </span>13:50:08<span class="number"> 2018 </span>- Fri Jul<span class="number"> 20 </span>13:52:47<span class="number"> 2018 </span> (00:02)</span><br><span class="line">wst      pts/8        :0.0             Thu Jul<span class="number"> 19 </span>15:19:43<span class="number"> 2018 </span>- Thu Jul<span class="number"> 19 </span>15:34:02<span class="number"> 2018 </span> (00:14)</span><br><span class="line">wst      pts/8        :0.0             Thu Jul<span class="number"> 19 </span>14:31:28<span class="number"> 2018 </span>- Thu Jul<span class="number"> 19 </span>14:31:31<span class="number"> 2018 </span> (00:00)</span><br><span class="line">wst      pts/4        :0.0             Thu Jul<span class="number"> 19 </span>11:55:53<span class="number"> 2018 </span>- Thu Jul<span class="number"> 19 </span>15:34:00<span class="number"> 2018 </span> (03:38)</span><br><span class="line">wst      pts/4        :0.0             Thu Jul<span class="number"> 19 </span>11:51:13<span class="number"> 2018 </span>- Thu Jul<span class="number"> 19 </span>11:51:28<span class="number"> 2018 </span> (00:00)</span><br><span class="line">wst      pts/3        :0.0             Thu Jul<span class="number"> 19 </span>11:23:10<span class="number"> 2018 </span>- Thu Jul<span class="number"> 19 </span>15:33:56<span class="number"> 2018 </span> (04:10)</span><br><span class="line">wst      pts/2        192.168.8.167    Thu Jul<span class="number"> 19 </span>11:15:22<span class="number"> 2018 </span>- Thu Jul<span class="number"> 19 </span>15:52:59<span class="number"> 2018 </span> (04:37)</span><br><span class="line">wst      pts/1        192.168.8.167    Thu Jul<span class="number"> 19 </span>10:43:45<span class="number"> 2018 </span>- Thu Jul<span class="number"> 19 </span>15:53:03<span class="number"> 2018 </span> (05:09)</span><br><span class="line">wst      pts/0        192.168.8.167    Thu Jul<span class="number"> 19 </span>09:39:35<span class="number"> 2018 </span>- Thu Jul<span class="number"> 19 </span>15:53:02<span class="number"> 2018 </span> (06:13)</span><br><span class="line">wst      pts/0        192.168.8.167    Wed Jul<span class="number"> 18 </span>10:57:37<span class="number"> 2018 </span>- Wed Jul<span class="number"> 18 </span>18:21:56<span class="number"> 2018 </span> (07:24)</span><br><span class="line">wst      pts/4        192.168.8.167    Tue Jul<span class="number"> 17 </span>14:39:01<span class="number"> 2018 </span>- Tue Jul<span class="number"> 17 </span>17:05:50<span class="number"> 2018 </span> (02:26)</span><br><span class="line">wst      pts/3        192.168.8.167    Tue Jul<span class="number"> 17 </span>13:44:47<span class="number"> 2018 </span>- Tue Jul<span class="number"> 17 </span>17:06:02<span class="number"> 2018 </span> (03:21)</span><br><span class="line">wst      pts/2        192.168.8.167    Tue Jul<span class="number"> 17 </span>13:33:03<span class="number"> 2018 </span>- Tue Jul<span class="number"> 17 </span>17:05:33<span class="number"> 2018 </span> (03:32)</span><br><span class="line">wst      pts/1        192.168.8.167    Tue Jul<span class="number"> 17 </span>11:16:58<span class="number"> 2018 </span>- Tue Jul<span class="number"> 17 </span>17:05:57<span class="number"> 2018 </span> (05:48)</span><br><span class="line">wst      pts/0        192.168.8.167    Tue Jul<span class="number"> 17 </span>09:36:20<span class="number"> 2018 </span>- Tue Jul<span class="number"> 17 </span>17:49:40<span class="number"> 2018 </span> (08:13)</span><br><span class="line">wst      pts/7        :0.0             Mon Jul<span class="number"> 16 </span>15:09:10<span class="number"> 2018 </span>  still logged in</span><br><span class="line">wst      pts/6        :0.0             Mon Jul<span class="number"> 16 </span>15:08:07<span class="number"> 2018 </span>- Thu Jul<span class="number"> 19 </span>15:35:23<span class="number"> 2018 </span>(3+00:27)</span><br><span class="line">wst      pts/5        :0.0             Mon Jul<span class="number"> 16 </span>15:01:04<span class="number"> 2018 </span>- Thu Jul<span class="number"> 19 </span>15:23:10<span class="number"> 2018 </span>(3+00:22)</span><br><span class="line">wst      :0           :0               Mon Jul<span class="number"> 16 </span>15:00:53<span class="number"> 2018 </span>  still logged in</span><br><span class="line">wst      pts/4        192.168.8.167    Mon Jul<span class="number"> 16 </span>14:06:51<span class="number"> 2018 </span>- Mon Jul<span class="number"> 16 </span>15:52:46<span class="number"> 2018 </span> (01:45)</span><br><span class="line">wst      pts/3        192.168.8.167    Mon Jul<span class="number"> 16 </span>11:16:07<span class="number"> 2018 </span>- Mon Jul<span class="number"> 16 </span>18:06:51<span class="number"> 2018 </span> (06:50)</span><br><span class="line">wst      pts/1        192.168.8.167    Mon Jul<span class="number"> 16 </span>10:54:49<span class="number"> 2018 </span>- Mon Jul<span class="number"> 16 </span>18:06:42<span class="number"> 2018 </span> (07:11)</span><br><span class="line">wst      pts/2        192.168.8.167    Mon Jul<span class="number"> 16 </span>10:38:56<span class="number"> 2018 </span>- Mon Jul<span class="number"> 16 </span>18:06:56<span class="number"> 2018 </span> (07:28)</span><br><span class="line">wst      pts/1        192.168.8.167    Mon Jul<span class="number"> 16 </span>09:54:30<span class="number"> 2018 </span>- Mon Jul<span class="number"> 16 </span>10:42:00<span class="number"> 2018 </span> (00:47)</span><br><span class="line">wst      pts/0        192.168.8.167    Mon Jul<span class="number"> 16 </span>09:46:38<span class="number"> 2018 </span>- Mon Jul<span class="number"> 16 </span>18:06:58<span class="number"> 2018 </span> (08:20)</span><br><span class="line">(unknown :0           :0               Mon Jul<span class="number"> 16 </span>09:44:14<span class="number"> 2018 </span>- Mon Jul<span class="number"> 16 </span>15:00:52<span class="number"> 2018 </span> (05:16)</span><br><span class="line">runlevel (to lvl 5)   3.10.0.3a2000+   Mon Jul<span class="number"> 16 </span>09:44:13<span class="number"> 2018 </span>  still running</span><br><span class="line">reboot   system boot  3.10.0.3a2000+   Mon Jul<span class="number"> 16 </span>17:44:04<span class="number"> 2018 </span>  still running</span><br><span class="line">shutdown system down  3.10.0.3a2000+   Fri Jul<span class="number"> 13 </span>17:42:14<span class="number"> 2018 </span>- Mon Jul<span class="number"> 16 </span>17:44:04<span class="number"> 2018 </span>(3+00:01)</span><br><span class="line">wst      pts/3        :0.0             Fri Jul<span class="number"> 13 </span>17:07:58<span class="number"> 2018 </span>- Fri Jul<span class="number"> 13 </span>17:42:02<span class="number"> 2018 </span> (00:34)</span><br><span class="line">wst      pts/4        192.168.8.167    Fri Jul<span class="number"> 13 </span>09:40:06<span class="number"> 2018 </span>- Fri Jul<span class="number"> 13 </span>16:32:28<span class="number"> 2018 </span> (06:52)</span><br><span class="line">wst      pts/3        192.168.8.167    Fri Jul<span class="number"> 13 </span>09:27:39<span class="number"> 2018 </span>- Fri Jul<span class="number"> 13 </span>14:54:36<span class="number"> 2018 </span> (05:26)</span><br><span class="line">wst      pts/5        192.168.8.167    Thu Jul<span class="number"> 12 </span>19:06:20<span class="number"> 2018 </span>- Thu Jul<span class="number"> 12 </span>19:21:56<span class="number"> 2018 </span> (00:15)</span><br><span class="line">wst      pts/4        192.168.8.167    Thu Jul<span class="number"> 12 </span>18:58:16<span class="number"> 2018 </span>- Thu Jul<span class="number"> 12 </span>19:21:49<span class="number"> 2018 </span> (00:23)</span><br><span class="line">wst      pts/3        192.168.8.179    Thu Jul<span class="number"> 12 </span>17:07:13<span class="number"> 2018 </span>- Thu Jul<span class="number"> 12 </span>19:18:49<span class="number"> 2018 </span> (02:11)</span><br><span class="line">wst      pts/2        :0.0             Thu Jul<span class="number"> 12 </span>16:22:08<span class="number"> 2018 </span>- Fri Jul<span class="number"> 13 </span>17:42:07<span class="number"> 2018 </span>(1+01:19)</span><br><span class="line">wst      pts/1        :0.0             Thu Jul<span class="number"> 12 </span>15:04:06<span class="number"> 2018 </span>- Fri Jul<span class="number"> 13 </span>17:42:09<span class="number"> 2018 </span>(1+02:38)</span><br><span class="line">wst      pts/1        192.168.8.167    Thu Jul<span class="number"> 12 </span>10:09:17<span class="number"> 2018 </span>- Thu Jul<span class="number"> 12 </span>14:26:53<span class="number"> 2018 </span> (04:17)</span><br><span class="line">wst      pts/0        :0.0             Thu Jul<span class="number"> 12 </span>09:30:10<span class="number"> 2018 </span>- Fri Jul<span class="number"> 13 </span>17:42:09<span class="number"> 2018 </span>(1+08:11)</span><br><span class="line">wst      :0           :0               Thu Jul<span class="number"> 12 </span>09:26:36<span class="number"> 2018 </span>- Fri Jul<span class="number"> 13 </span>17:42:13<span class="number"> 2018 </span>(1+08:15)</span><br><span class="line">(unknown :0           :0               Thu Jul<span class="number"> 12 </span>09:26:14<span class="number"> 2018 </span>- Thu Jul<span class="number"> 12 </span>09:26:36<span class="number"> 2018 </span> (00:00)</span><br><span class="line">runlevel (to lvl 5)   3.10.0.3a2000+   Thu Jul<span class="number"> 12 </span>09:26:13<span class="number"> 2018 </span>- Fri Jul<span class="number"> 13 </span>17:42:14<span class="number"> 2018 </span>(1+08:16)</span><br><span class="line">reboot   system boot  3.10.0.3a2000+   Thu Jul<span class="number"> 12 </span>17:26:04<span class="number"> 2018 </span>- Fri Jul<span class="number"> 13 </span>17:42:14<span class="number"> 2018 </span>(1+00:16)</span><br><span class="line">wst      pts/1        192.168.8.165    Tue Jul<span class="number"> 10 </span>19:27:05<span class="number"> 2018 </span>- Tue Jul<span class="number"> 10 </span>20:20:12<span class="number"> 2018 </span> (00:53)</span><br><span class="line">wst      pts/1        192.168.8.165    Tue Jul<span class="number"> 10 </span>14:59:36<span class="number"> 2018 </span>- Tue Jul<span class="number"> 10 </span>19:26:28<span class="number"> 2018 </span> (04:26)</span><br><span class="line">wst      pts/2        192.168.8.167    Mon Jul <span class="number"> 9 </span>18:52:45<span class="number"> 2018 </span>- Mon Jul <span class="number"> 9 </span>18:56:30<span class="number"> 2018 </span> (00:03)</span><br><span class="line">wst      pts/2        192.168.8.167    Mon Jul <span class="number"> 9 </span>15:42:22<span class="number"> 2018 </span>- Mon Jul <span class="number"> 9 </span>18:50:20<span class="number"> 2018 </span> (03:07)</span><br><span class="line"></span><br><span class="line">wtmp 开始 Wed Jun <span class="number"> 8 </span>17:16:26 2016</span><br></pre></td></tr></table></figure>
<p>第一列是用户名，第一列是reboot的表示系统启动，第二列是表示虚拟终端登录信息，比如图形界面登录有的是“：0”，有的是“ttyx”,不同发行版的系统是有细微差别的。</p>
<p>第三列是用户的登录IP获取内核信息，如果是第一列是reboot，那么第三列就是内核信息，如果是正常用户登录，那么第三列就是本地或者远程IP地址。</p>
<p>再接下来第四列是开始时间，即系统的启动时间或者登录时间。</p>
<p>第五列是结束时间，可能是系统的关机时间或者是用户的注销时间，当然如果是still running，则代表该系统还在运行中，我们可以通过第四列判断出系统的开机时间。</p>
<p>如果是still logged in，则表示用户还在连接中，我们可以通过第四列判断出用户的登录时间。</p>
<p>第六列是运行时间统计，这里有个问题需要注意以下，有时候这个值是负的，这很神奇？时间怎么可能是负的，其实是因为系统开机时记录的时间不准确造成的，记录的时间比实际时间晚了8个小时。</p>
<p>在获取系统开机时间时，我们需要将这个八个小时减去才能获取到正确的时间。具体要不要减去这8个小时要根据你电脑的世纪情况来判断，基本方法就是第六列有负值，那么肯定就需要减去这8个小时。</p>
<p>这里面其实还是需要你仔细分析差异点，然后找出规律，最后通过不同的条件判断出系统的行为。</p>
<h2 id="关键代码"><a href="#关键代码" class="headerlink" title="关键代码"></a>关键代码</h2><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    now_str = datetime.datetime.now().strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line">    <span class="comment"># 通过subprocess包执行linux命令，然后获取返回值</span></span><br><span class="line">    ret, <span class="built_in">result</span> = subprocess.getstatusoutput(<span class="string">'last -F -x -n 30'</span>)</span><br><span class="line">    <span class="keyword">if</span> ret != <span class="number">0</span>:</span><br><span class="line">        <span class="comment">#print('error')</span></span><br><span class="line">        os.<span class="title">_exit</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 按行将日志信息存储起来</span></span><br><span class="line">    contents_new = <span class="built_in">result</span>.<span class="built_in">split</span>(<span class="string">'\n'</span>)</span><br><span class="line">    contents_old = []</span><br><span class="line">    <span class="comment"># 读取之前缓存的日志信息到contents_old，然后对比contents_old和contents_new</span></span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(FILENAME):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(FILENAME, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> <span class="built_in">line</span> <span class="keyword">in</span> f.readlines():</span><br><span class="line">                <span class="built_in">line</span> = base64.b64decode(<span class="built_in">line</span>).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">                contents_old.append(<span class="built_in">line</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(FILENAME, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> content_new <span class="keyword">in</span> contents_new :</span><br><span class="line">                content_new = content_new.strip(<span class="string">'\n'</span>)</span><br><span class="line">                temp = base64.b64encode(<span class="keyword">bytes</span>(content_new, <span class="string">'utf-8'</span>))</span><br><span class="line">                f.<span class="built_in">write</span>(temp)</span><br><span class="line">                f.<span class="built_in">write</span>(b<span class="string">'\n'</span>)</span><br><span class="line">        os.<span class="title">_exit</span>(<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 处理新产生的日志文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(FILENAME, <span class="string">'wb'</span>) <span class="keyword">as</span> f :</span><br><span class="line">        <span class="keyword">for</span> content_new <span class="keyword">in</span> contents_new :</span><br><span class="line">            <span class="keyword">if</span> (content_new <span class="keyword">and</span> (<span class="string">'wtmp'</span> <span class="keyword">not</span> <span class="keyword">in</span> content_new) <span class="keyword">and</span></span><br><span class="line">                (<span class="string">'down'</span> <span class="keyword">not</span> <span class="keyword">in</span> content_new) <span class="keyword">and</span> (<span class="string">'crash'</span> <span class="keyword">not</span> <span class="keyword">in</span> content_new) <span class="keyword">and</span></span><br><span class="line">                (<span class="string">'shutdown'</span> <span class="keyword">not</span> <span class="keyword">in</span> content_new) <span class="keyword">and</span> (<span class="string">'runlevel'</span> <span class="keyword">not</span> <span class="keyword">in</span> content_new)</span><br><span class="line">                ):</span><br><span class="line">                <span class="comment"># 如果新查询到的日志在原来的缓存文件中没有，那么就代表系统有新的日志产生，我们处理的就是这部分日志信息。</span></span><br><span class="line">                <span class="keyword">if</span> content_new <span class="keyword">not</span> <span class="keyword">in</span> contents_old :</span><br><span class="line">                    <span class="comment">#print('that is what we should deal with')</span></span><br><span class="line">                    <span class="comment">#print(content_new)</span></span><br><span class="line">                    <span class="comment"># 分析日志信息的函数</span></span><br><span class="line">                    deal_log(content_new, now_str)</span><br><span class="line">            <span class="keyword">else</span> :</span><br><span class="line">                <span class="comment">#print('no use')</span></span><br><span class="line">                pass</span><br><span class="line">            <span class="comment"># 使用base64进行加密缓存日志信息（项目需要，其实就是不想直接暴露这些信息给用户）</span></span><br><span class="line">            content_new = base64.b64encode(<span class="keyword">bytes</span>(content_new, <span class="string">'utf-8'</span>))</span><br><span class="line">            f.<span class="built_in">write</span>(content_new)</span><br><span class="line">            f.<span class="built_in">write</span>(b<span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure>
<p>deal_log的内容：<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">def deal_log(content_new<span class="type"></span>, now_str):<span class="type"></span></span><br><span class="line"><span class="type">    content_words </span>= content_new<span class="type"></span>.split(<span class="string">' '</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="string">''</span> <span class="keyword">in</span> content_words :<span class="type"></span></span><br><span class="line"><span class="type">        content_words</span>.remove(<span class="string">''</span>)</span><br><span class="line">    ret, plat = subprocess.getstatusoutput(<span class="string">'uname -m'</span>)</span><br><span class="line">    <span class="keyword">if</span> plat == <span class="string">'aarch64'</span> :<span class="type"></span></span><br><span class="line"><span class="type">        </span>#print(<span class="string">'kylin'</span>)</span><br><span class="line">        deal_kylin_log(content_new<span class="type"></span>, content_words)</span><br><span class="line">    elif plat == <span class="string">'i686'</span>:<span class="type"></span></span><br><span class="line"><span class="type">        </span>#print(<span class="string">'cods'</span>)</span><br><span class="line">        deal_cods_log(content_new<span class="type"></span>, content_words, now_str)</span><br><span class="line">    elif plat == <span class="string">'mips64'</span> :<span class="type"></span></span><br><span class="line"><span class="type">        </span>#print(<span class="string">'neo'</span>)</span><br><span class="line">        deal_neo_log(content_new<span class="type"></span>, content_words)</span><br></pre></td></tr></table></figure></p>
<p>其实就是根据具体不同的平台来进行不同的处理。</p>
<p>比如kylin平台：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">def fix_time(<span class="built_in">time</span>) :</span><br><span class="line">    format_time = datetime.datetime.strptime(<span class="built_in">time</span>[<span class="number">3</span>] + <span class="string">'-'</span> + <span class="built_in">time</span>[<span class="number">0</span>] + <span class="string">'-'</span> +</span><br><span class="line">    <span class="built_in">time</span>[<span class="number">1</span>] + <span class="string">' '</span> + <span class="built_in">time</span>[<span class="number">2</span>], <span class="string">'%Y-%b-%d %H:%M:%S'</span>)</span><br><span class="line">    time_right = format_time + datetime.timedelta(hours = <span class="number">-8</span>)</span><br><span class="line"></span><br><span class="line">    time_right_str = time_right.strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> time_right_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def formate_time(<span class="built_in">time</span>) :</span><br><span class="line">    #<span class="built_in">print</span>(<span class="built_in">time</span>)</span><br><span class="line">    format_time = datetime.datetime.strptime(<span class="built_in">time</span>[<span class="number">3</span>] + <span class="string">'-'</span> + <span class="built_in">time</span>[<span class="number">0</span>] + <span class="string">'-'</span> +</span><br><span class="line">        <span class="built_in">time</span>[<span class="number">1</span>] + <span class="string">' '</span> + <span class="built_in">time</span>[<span class="number">2</span>], <span class="string">'%Y-%b-%d %H:%M:%S'</span>)</span><br><span class="line">    format_time_str = format_time.strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> format_time_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def deal_kylin_log(content_new, content_words) :</span><br><span class="line">    user = content_words[<span class="number">0</span>]</span><br><span class="line">    # login</span><br><span class="line">    <span class="keyword">if</span> ((<span class="string">'still logged in'</span> <span class="keyword">in</span> content_new) <span class="keyword">or</span> (<span class="string">'gone - no logout'</span> <span class="keyword">in</span> content_new)) :</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">':0.0'</span> <span class="keyword">not</span> <span class="keyword">in</span> content_words[<span class="number">2</span>]) :</span><br><span class="line">            action = <span class="string">'登录'</span></span><br><span class="line">            login_time = formate_time(content_words[<span class="number">4</span>:<span class="number">8</span>])</span><br><span class="line">            <span class="keyword">if</span> <span class="string">':0'</span> <span class="keyword">in</span> content_words[<span class="number">2</span>] :</span><br><span class="line">                location = <span class="string">'本地'</span></span><br><span class="line">            <span class="keyword">else</span> :</span><br><span class="line">                location = <span class="string">'远程('</span> + content_words[<span class="number">2</span>] + <span class="string">')'</span></span><br><span class="line">            #<span class="built_in">print</span>(<span class="string">'user: '</span> +  user + <span class="string">' action: '</span> + action + <span class="string">' locaton: '</span> + </span><br><span class="line">            #    location + <span class="string">' login_time: '</span> + login_time)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">'login|登录|&lt;Object class="时间" name="'</span> + login_time + <span class="string">'"&gt;&lt;登录用户&gt;'</span> +</span><br><span class="line">                user + <span class="string">'&lt;/登录用户&gt;&lt;登录点&gt;'</span> + location + <span class="string">'&lt;/登录点&gt;&lt;登录时间&gt;'</span> + login_time +</span><br><span class="line">                <span class="string">'&lt;/登录时间&gt;&lt;登出时间/&gt;&lt;状态&gt;登录&lt;/状态&gt;&lt;/Object&gt;|&lt;Reason/&gt;|2|审计|成功'</span>)</span><br><span class="line">    # boot</span><br><span class="line">    elif (<span class="string">'still running'</span> <span class="keyword">in</span> content_new) <span class="keyword">and</span> (<span class="string">'reboot'</span> <span class="keyword">in</span> content_new) :</span><br><span class="line">        boot_time = fix_time(content_words[<span class="number">5</span>:<span class="number">9</span>])</span><br><span class="line">        action = <span class="string">'开机'</span></span><br><span class="line">        #<span class="built_in">print</span>(<span class="string">'user: '</span> +  user + <span class="string">' action: '</span> + action + <span class="string">' boot_time: '</span> + boot_time)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'boot|开机|&lt;Object class="时间" name="'</span> + boot_time + <span class="string">'"&gt;&lt;开机时间&gt;'</span> + boot_time +</span><br><span class="line">            <span class="string">'&lt;/开机时间&gt;&lt;状态&gt;开机&lt;/状态&gt;&lt;/Object&gt;|&lt;Reason/&gt;|2|审计|成功'</span>)</span><br><span class="line"></span><br><span class="line">    # shutdown</span><br><span class="line">    elif (<span class="string">'reboot'</span> <span class="keyword">in</span> content_new) <span class="keyword">and</span> (<span class="string">'still running'</span> <span class="keyword">not</span> <span class="keyword">in</span> content_new) :</span><br><span class="line">        shutdown_time = formate_time(content_words[<span class="number">11</span>:<span class="number">15</span>])</span><br><span class="line">        action = <span class="string">'关机'</span></span><br><span class="line">        #<span class="built_in">print</span>(<span class="string">'user: '</span> +  user + <span class="string">' action: '</span> + action + <span class="string">' shutdown_time: '</span> + shutdown_time)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'shutdown|关机|&lt;Object class="时间" name="'</span> + shutdown_time + <span class="string">'"&gt;&lt;关机时间&gt;'</span> +</span><br><span class="line">            shutdown_time + <span class="string">'&lt;/关机时间&gt;'</span> + <span class="string">'&lt;状态&gt;关机&lt;/状态&gt;&lt;/Object&gt;|&lt;Reason/&gt;|2|审计|成功'</span>)</span><br><span class="line"></span><br><span class="line">    elif ( <span class="string">':0.0'</span> <span class="keyword">not</span> <span class="keyword">in</span> content_words[<span class="number">2</span>]):</span><br><span class="line">        action = <span class="string">'注销'</span></span><br><span class="line">        logout_time = formate_time(content_words[<span class="number">10</span>:<span class="number">14</span>])</span><br><span class="line">        <span class="keyword">if</span> <span class="string">':0'</span> <span class="keyword">in</span> content_words[<span class="number">2</span>] :</span><br><span class="line">            location = <span class="string">'本地'</span></span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            location = <span class="string">'远程('</span> + content_words[<span class="number">2</span>] + <span class="string">')'</span></span><br><span class="line">        #<span class="built_in">print</span>(<span class="string">'user: '</span> +  user + <span class="string">' action: '</span> + action + <span class="string">' location:'</span> + location + </span><br><span class="line">        #    <span class="string">' logout_time: '</span> + logout_time)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'logout|注销|&lt;Object class="时间" name="'</span> + logout_time + <span class="string">'"&gt;&lt;注销用户&gt;'</span> +</span><br><span class="line">            user + <span class="string">'&lt;/注销用户&gt;&lt;注销位置&gt;'</span> + location + <span class="string">'&lt;/注销位置&gt;&lt;注销时间&gt;'</span> + logout_time +</span><br><span class="line">            <span class="string">'&lt;/注销时间&gt;&lt;登出时间/&gt;&lt;状态&gt;注销&lt;/状态&gt;&lt;/Object&gt;|&lt;Reason/&gt;|2|审计|成功'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        #<span class="built_in">print</span>(<span class="string">'can not recognize'</span>)</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure>
<p>最后把日志组织成相应的格式输出，由c程序捕获这些输出就可以了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总体思路就是用python做一个中间处理的小工具，通过调用这个小工具可以将固定格式的日志信息处理之后组织成我们想要的信息返回回来，这里我是通过直接打印然后让c程序获取python的打印信息。</p>
<p>我知道c和python可以通过相应的api互相调用，暂时没有研究，回头研究一下看能不能做个改进。</p>
<p><a href="https://github.com/jiaoqiyuan/audit_sys_info.git" target="_blank" rel="noopener">项目地址</a></p>
<p>2018.7.20 北京 晴</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/06/30/编译那些事儿2-编译/" rel="next" title="编译那些事儿2-编译、汇编、链接（完结）">
                <i class="fa fa-chevron-left"></i> 编译那些事儿2-编译、汇编、链接（完结）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/08/28/廖雪峰javase笔记/" rel="prev" title="廖雪峰javase笔记">
                廖雪峰javase笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar-6.png" alt="Jony Chiao">
            
              <p class="site-author-name" itemprop="name">Jony Chiao</p>
              <p class="site-description motion-element" itemprop="description">bulabula</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">79</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/jiaoqiyuan" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:jijujiu@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#需求"><span class="nav-number">1.</span> <span class="nav-text">需求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分析"><span class="nav-number">2.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实践"><span class="nav-number">3.</span> <span class="nav-text">实践</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关键代码"><span class="nav-number">4.</span> <span class="nav-text">关键代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">5.</span> <span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jony Chiao</span>

  
</div>





        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 访问总量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: true,
        appId: 'n2HspM41RbogfYToohbhdzcF-gzGzoHsz',
        appKey: 'BmbN7noqgmLyN99xJLQfDwYv',
        placeholder: 'ヾﾉ≧∀≦)o来啊，快活啊!',
        avatar:'retro',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  

</body>
</html>
